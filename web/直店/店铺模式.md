# 店铺模式

## 状态定义

### 基础状态定义

|名称|启用|禁用|十进制|
|--|--|--|--|
|会员商城|1|0|1|
|团购商城|10|00|2|
|分销商城|100|000|4|
|拼团商城|1000|0000|8|

### 组合状态标志

|名称|启用|禁用|十进制|
|--|--|--|--|
|分销+拼团+团购|11xx|00xx|12|
|团购+拼团|11xx|00xx|12|
|会员商城+拼团+团购|11x1|00x0|13|

### 判断公司店铺拥有模式

<!-- todo -->

## 权限设计

### 设计原则

- 最小化变动
- 最大可拓展性
- 最高可用性

### 流程

#### 方案一

上游/店铺/会员 -> 登录 -> 获取店铺拥有店铺模式模块 -> 保存登录状态 -> 返回店铺拥有模块
页面 -> 进入页面 -> 前端判断模块元素展示 

例如: 

小王登录店铺管理段 -> 登录接口返回 -> 小王拥有模式 [分销、团购、基础商城] 
-> 小王进入商品管理 -> 前端根据 模块有 [基础商城] 显示 元素 自建商品

优点:
    - 后端变动小
    - 前端前期更改速度快
缺点:
    - 需要前端和测试精准把控所有页面元素展示。

#### 方案二

上游/店铺/会员 -> 登录 -> 获取店铺拥有店铺模式模块 -> 保存登录状态 -> 返回所有可操作元素

页面 -> 进入页面 -> 前端 根据元素判断展示

例如:
小王登录店铺管理段 -> 登录接口返回 -> 小王拥有模式及所有权限元素 [商品管理、商品管理-自建商品、商品管理-导入商品、......] -> 前端根据 权限元素有 [自建商品、导入商品] 展示 自建商品和导入商品 页面元素

有点:
    - 权限粒度小，可控制性高
缺点:
    - 前期需要投入大量时间整理功能元素
    - 需要

#### 方案三

上游/店铺/会员 -> 登录 -> 获取店铺拥有店铺模式 -> 保存登录状态 -> 返回最变动可操作元素

页面 -> 进入页面 -> 前端 根据元素判断展示

例如:
假设 会员商城/分销商城/团购商城都有 商品管理功能A
会员商城有 [自建商品] 元素
分销商城没有特殊元素
团购商品有 [导入商品] 元素 
权限重合变异情况。待定

小王登录店铺管理段 -> 登录接口返回 -> 
小王如果是 会员商城 -> 返回 拥有[自建商品] 元素 -> 前端根据权限元素字端判断展示
小王如果是 分销商城 -> 返回 拥有[] 元素 -> 前端根据权限元素字端判断展示
小王如果是 团购商品 -> 返回 拥有[导入商品] 元素 -> 前端根据权限元素字端判断展示

优点:
    - 相对方案二、整理功能元素字端大幅减少
    - 服务端可控制页面元素
缺点:
    - 页面草

## 分销订单及订单状态

### 订单状态定义

|name|value|备注|
|--|--|--|
|待接单|220||
|待发货|221||
|待完成|222||
|已完成|500||

### 智能名片入口进入分销商城解决方案

#### 方案一 、 关联小程序直接跳转。

在需要跳转的地方，前端使用原生api `wx.navigateToMiniProgram` 直接跳转到直店。 

缺点:
    - 跳转数量限制10。

#### 方案二 、 在 `直店` 开放接口 `名片` 获取手机号关联店铺 `小程序码`

## 功能组织图

